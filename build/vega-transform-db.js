var r=require("vega");"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var t=require("querystring");function e(t){r.Transform.call(this,[],t)}require("http"),e.setHttpOptions=function(r){return r?(this._httpOptions=r,this):this._httpOptions},e.Definition={type:"dbtransform",metadata:{changes:!0,source:!0},params:[{name:"query",type:"string",required:!0}]},r.inherits(e,r.Transform).transform=function(o,n){try{var i=this;function s(){a.forEach(r.ingest);var t=n.fork(n.NO_FIELDS&n.NO_SOURCE);return i.value=t.add=t.source=t.rem=a,t}if(!e._httpOptions)throw Error("Vega Transform Postgres http options missing. Assign it with setHttpOptions.");if(!o.query)throw Error("Internal error: this._query should be defined");var a=[],u=function(r,t){try{var e=r()}catch(r){return t(r)}return e&&e.then?e.then(void 0,t):e}(function(){return Promise.resolve(function(){try{var r=e._httpOptions;return Promise.resolve(fetch(r.url,{method:r.method,mode:r.mode,headers:r.headers,body:t.stringify({query:o.query})})).then(function(r){return r.ok?Promise.resolve(r.json()):Promise.resolve(r.json()).then(function(r){throw Error((r.error+": "+r.message).replace(/(\r\n|\n|\r)/gm,""))})})}catch(r){return Promise.reject(r)}}()).then(function(r){a=r})},function(r){console.log(r)});return Promise.resolve(u&&u.then?u.then(s):s())}catch(r){return Promise.reject(r)}},module.exports=e;
//# sourceMappingURL=vega-transform-db.js.map
